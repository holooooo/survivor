# å®‰å…¨å±‹ç³»ç»Ÿ

å®‰å…¨å±‹ç³»ç»Ÿæ˜¯æ¸¸æˆçš„å±€å¤–åŸ¹å…»æ ¸å¿ƒåŠŸèƒ½ï¼Œæä¾›æˆ¿é—´åˆ‡æ¢ã€æ¸¸æˆçŠ¶æ€ç®¡ç†å’Œå„ç§åŸ¹å…»åŠŸèƒ½çš„å…¥å£ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
å®‰å…¨å±‹ç³»ç»Ÿ
â”œâ”€â”€ SafeHouse (ä¸»åœºæ™¯)
â”œâ”€â”€ SafeHouseManager (æˆ¿é—´ç®¡ç†å™¨)
â”œâ”€â”€ NavigationBar (å¯¼èˆªæ ç»„ä»¶)
â””â”€â”€ æˆ¿é—´ç³»ç»Ÿ
    â”œâ”€â”€ MainRoom (ä¸»ç•Œé¢)
    â”œâ”€â”€ BattleRoom (ä½œæˆ˜å®¤)
    â”œâ”€â”€ RecruitRoom (æ‹›å‹Ÿå®¤)
    â”œâ”€â”€ UpgradeRoom (æ”¹é€ å®¤)
    â”œâ”€â”€ ResearchRoom (ç ”ç©¶å®¤)
    â””â”€â”€ BrandRoom (å“ç‰Œå®¤)
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/scenes/safe_house/
â”œâ”€â”€ safe_house.tscn              # ä¸»å®‰å…¨å±‹åœºæ™¯
â”œâ”€â”€ safe_house.gd                # ä¸»åœºæ™¯è„šæœ¬
â”œâ”€â”€ safe_house_manager.gd        # æˆ¿é—´ç®¡ç†å™¨
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ navigation_bar.tscn      # å¯¼èˆªæ åœºæ™¯
â”‚   â””â”€â”€ navigation_bar.gd        # å¯¼èˆªæ è„šæœ¬
â”œâ”€â”€ rooms/                       # å„ä¸ªæˆ¿é—´
â”‚   â”œâ”€â”€ main_room.tscn/gd        # ä¸»æˆ¿é—´
â”‚   â”œâ”€â”€ battle_room.tscn/gd      # ä½œæˆ˜å®¤
â”‚   â”œâ”€â”€ recruit_room.tscn/gd     # æ‹›å‹Ÿå®¤
â”‚   â”œâ”€â”€ upgrade_room.tscn/gd     # æ”¹é€ å®¤
â”‚   â”œâ”€â”€ research_room.tscn/gd    # ç ”ç©¶å®¤
â”‚   â””â”€â”€ brand_room.tscn/gd       # å“ç‰Œå®¤
â””â”€â”€ test_safe_house.gd           # æµ‹è¯•è„šæœ¬
```

## ğŸ® åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- âœ… æˆ¿é—´åˆ‡æ¢ç³»ç»Ÿ
- âœ… æ¸¸æˆå‘¨æœŸç®¡ç†ï¼ˆæ¯æ¬¡æˆ˜æ–—ç®—ä¸€å‘¨ï¼‰
- âœ… å¯¼èˆªæ å¿«é€Ÿåˆ‡æ¢
- âœ… ä¸»æˆ¿é—´çŠ¶æ€æ˜¾ç¤º
- âœ… æˆ¿é—´é¢„è§ˆåŠŸèƒ½

### æˆ¿é—´åŠŸèƒ½
- **ä¸»ç•Œé¢**: æ˜¾ç¤ºæ¸¸æˆæ—¶é—´ã€å‘¨æœŸå’Œæˆ¿é—´é¢„è§ˆ
- **ä½œæˆ˜å®¤**: é€‰æ‹©è§’è‰²å’Œç›®çš„åœ°ï¼Œè¿›å…¥æˆ˜æ–—ï¼ˆå¾…å®ç°ï¼‰
- **æ‹›å‹Ÿå®¤**: æ‹›å‹Ÿã€æŸ¥çœ‹ã€å¼€é™¤è§’è‰²ï¼ˆå¾…å®ç°ï¼‰
- **æ”¹é€ å®¤**: æ”¹é€ è§’è‰²èƒ½åŠ›ï¼ˆå¾…å®ç°ï¼‰
- **ç ”ç©¶å®¤**: ç ”ç©¶æ–°æŠ€æœ¯ï¼ˆå¾…å®ç°ï¼‰
- **å“ç‰Œå®¤**: å“ç‰Œåˆä½œå’Œé€šè¡Œè¯ï¼ˆå¾…å®ç°ï¼‰

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬é›†æˆ

åœ¨å…¶ä»–åœºæ™¯ä¸­åˆ‡æ¢åˆ°å®‰å…¨å±‹ï¼š

```gdscript
# é€šè¿‡EventBusåˆ‡æ¢ï¼ˆæ¨èï¼‰
EventBus.change_scene_safely("res://src/scenes/safe_house/safe_house.tscn")

# æˆ–ç›´æ¥åˆ‡æ¢
get_tree().change_scene_to_file("res://src/scenes/safe_house/safe_house.tscn")
```

### 2. æˆ˜æ–—å®Œæˆååˆ‡æ¢

åœ¨æˆ˜æ–—åœºæ™¯ä¸­ï¼Œæˆ˜æ–—ç»“æŸæ—¶ï¼š

```gdscript
# å‘é€æˆ˜æ–—å®Œæˆä¿¡å·ï¼ˆä¼šè‡ªåŠ¨å¢åŠ æ¸¸æˆå‘¨æœŸï¼‰
EventBus.battle_completed.emit()

# ç„¶ååˆ‡æ¢åˆ°å®‰å…¨å±‹
EventBus.change_scene_safely("res://src/scenes/safe_house/safe_house.tscn")
```

### 3. æµ‹è¯•ç³»ç»Ÿ

ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½ï¼š

```gdscript
# åˆ›å»ºæµ‹è¯•èŠ‚ç‚¹
var tester = preload("res://src/scenes/safe_house/test_safe_house.gd").new()
add_child(tester)

# æˆ–æ‰‹åŠ¨åˆ‡æ¢åˆ°å®‰å…¨å±‹
tester.switch_to_safe_house()
```

## ğŸ”§ æ‰©å±•å¼€å‘

### æ·»åŠ æ–°æˆ¿é—´

1. åˆ›å»ºæˆ¿é—´è„šæœ¬ï¼ˆç»§æ‰¿Controlï¼‰
2. å®ç° `on_room_activated()` æ–¹æ³•
3. åœ¨ `SafeHouseManager.RoomType` æšä¸¾ä¸­æ·»åŠ æ–°ç±»å‹
4. æ›´æ–°åœºæ™¯æ–‡ä»¶å’Œå¯¼èˆªæ 

### æˆ¿é—´é€šä¿¡

å„æˆ¿é—´é€šè¿‡SafeHouseManagerè¿›è¡Œé€šä¿¡ï¼š

```gdscript
# è·å–ç®¡ç†å™¨å¼•ç”¨
var manager = get_parent().get_node("SafeHouseManager")

# åˆ‡æ¢åˆ°å…¶ä»–æˆ¿é—´
manager.switch_to_room(SafeHouseManager.RoomType.BATTLE)

# è·å–æ¸¸æˆå‘¨æœŸ
var week = manager.get_game_week()
```

## ğŸ“‹ å¾…å®ç°åŠŸèƒ½

1. **ä½œæˆ˜å®¤å®Œæ•´åŠŸèƒ½**
   - è§’è‰²é€‰æ‹©ç•Œé¢
   - ç›®çš„åœ°é€‰æ‹©
   - è£…å¤‡é…ç½®
   - æˆ˜æ–—å‚æ•°è®¾ç½®

2. **æ‹›å‹Ÿå®¤åŠŸèƒ½**
   - è§’è‰²åˆ—è¡¨æ˜¾ç¤º
   - æ‹›å‹Ÿç³»ç»Ÿ
   - è§’è‰²ç®¡ç†

3. **æ”¹é€ å®¤åŠŸèƒ½**
   - è§’è‰²å±æ€§å‡çº§
   - è£…å¤‡å¼ºåŒ–
   - æŠ€èƒ½å­¦ä¹ 

4. **ç ”ç©¶å®¤åŠŸèƒ½**
   - ç§‘æŠ€æ ‘
   - ç ”ç©¶è¿›åº¦
   - è§£é”æ–°åŠŸèƒ½

5. **å“ç‰Œå®¤åŠŸèƒ½**
   - å“ç‰Œåˆ—è¡¨
   - åˆä½œåè®®
   - é€šè¡Œè¯ç³»ç»Ÿ

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æˆ¿é—´åˆ‡æ¢å¤±è´¥**
   - æ£€æŸ¥åœºæ™¯æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤SafeHouseManageræ­£ç¡®åˆå§‹åŒ–

2. **å¯¼èˆªæ æŒ‰é’®æ— å“åº”**
   - ç¡®è®¤ä¿¡å·è¿æ¥æ­£ç¡®
   - æ£€æŸ¥èŠ‚ç‚¹è·¯å¾„å¼•ç”¨

3. **æ¸¸æˆå‘¨æœŸä¸æ›´æ–°**
   - ç¡®è®¤EventBus.battle_completedä¿¡å·æ­£ç¡®å‘é€
   - æ£€æŸ¥SafeHouseManageræ˜¯å¦è¿æ¥ä¿¡å·

### è°ƒè¯•æ–¹æ³•

å¯ç”¨è¯¦ç»†æ—¥å¿—æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€ï¼š

```gdscript
# åœ¨å®‰å…¨å±‹åœºæ™¯çš„_ready()ä¸­æ·»åŠ 
print("å½“å‰æˆ¿é—´: ", safe_house_manager.get_current_room())
print("æ¸¸æˆå‘¨æœŸ: ", safe_house_manager.get_game_week())
```

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- âœ… å®ŒæˆåŸºç¡€æˆ¿é—´åˆ‡æ¢ç³»ç»Ÿ
- âœ… å®ç°å¯¼èˆªæ ç»„ä»¶
- âœ… æ·»åŠ æ¸¸æˆå‘¨æœŸç®¡ç†
- âœ… åˆ›å»ºæ‰€æœ‰æˆ¿é—´åŸºç¡€ç»“æ„
- âœ… é›†æˆEventBusé€šä¿¡ 