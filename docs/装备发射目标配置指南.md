# 装备发射目标配置指南

## 概述

装备系统现在支持灵活的发射目标配置，允许不同装备采用不同的目标选择策略。

## 目标类型

### 可用的目标类型

1. **最近敌人** (`Constants.TargetType.最近敌人`)
   - 攻击范围内距离最近的敌人
   - 默认选项，兼容现有装备

2. **最低生命值敌人** (`Constants.TargetType.最低生命值敌人`)
   - 攻击范围内生命值最低的敌人
   - 适合优先清理残血敌人的策略

3. **随机敌人** (`Constants.TargetType.随机敌人`)
   - 攻击范围内随机选择的敌人
   - 增加战斗的随机性和多样性

4. **随机位置** (`Constants.TargetType.随机位置`)
   - 向随机方向发射
   - 适合范围攻击或无需精确瞄准的武器

## 配置参数

### EmitterEquipmentResource 中的配置

```gdscript
@export_group("目标配置")
@export var target_type: Constants.TargetType = Constants.TargetType.最近敌人
@export var continuous_attack: bool = false
```

### 参数说明

- **target_type**: 发射目标类型
- **continuous_attack**: 持续攻击开关
  - `true`: 没有目标时也会攻击（使用默认方向）
  - `false`: 没有目标时不攻击

## 使用示例

### 示例1: 精确狙击装备
```gdscript
target_type = Constants.TargetType.最低生命值敌人
continuous_attack = false
```

### 示例2: 随机火力压制装备
```gdscript
target_type = Constants.TargetType.随机位置
continuous_attack = true
```

### 示例3: 智能追踪装备
```gdscript
target_type = Constants.TargetType.最近敌人
continuous_attack = false
```

## 实现细节

### 目标选择逻辑

装备基类 `EquipmentBase` 根据配置的 `target_type` 调用相应的目标选择方法：

- `_get_direction_to_nearest_enemy()`: 最近敌人
- `_get_direction_to_lowest_health_enemy()`: 最低生命值敌人
- `_get_direction_to_random_enemy()`: 随机敌人
- `_get_random_direction_in_range()`: 随机方向

### 攻击条件检查

`EmitterEquipmentBase` 中的 `_can_use_specific()` 方法根据配置检查是否可以攻击：

1. 如果 `continuous_attack = true`，始终允许攻击
2. 否则检查是否有有效目标：
   - 敌人类型：检查范围内是否有对应类型的敌人
   - 随机位置：始终允许攻击

### 性能优化

- 使用敌人缓存的距离信息提高性能
- 避免重复计算距离
- 合理的更新频率控制

## 兼容性

- 现有装备默认使用"最近敌人"模式
- 现有装备资源文件已自动添加默认配置
- 不影响现有游戏逻辑

## 扩展性

通过修改 `Constants.TargetType` 枚举可以轻松添加新的目标类型，如：
- 生命值最高的敌人
- 距离特定位置最近的敌人
- 特定类型的敌人优先级

只需在枚举中添加新类型并在 `_get_target_direction()` 中添加对应的 case 分支即可。 